# 4

4
2
0
2

g
u
A
5
1

]

R
C
.
s
c
[

1
v
3
3
4
8
0
.
8
0
4
2
:
v
i
X
r
a

A ROBUST MULTI-STAGE INTRUSION DETECTION SYSTEM FOR
IN-VEHICLE NETWORK SECURITY USING HIERARCHICAL
FEDERATED LEARNING

A PREPRINT

Muzun Althunayyan

School of Computer Science & Informatics
Cardiff University
Cardiff, United Kingdom
AlthunayyanMS@cardiff.ac.uk

Amir Javed
School of Computer Science & Informatics
Cardiff University
Cardiff, United Kingdom
javeda7@cardiff.ac.uk

Omer Rana
School of Computer Science & Informatics
Cardiff University
Cardiff, United Kingdom
ranaof@cardiff.ac.uk

August 19, 2024

ABSTRACT

As connected and autonomous vehicles proliferate, the Controller Area Network (CAN) bus has
become the predominant communication standard for in-vehicle networks due to its speed and
efficiency. However, the CAN bus lacks basic security measures such as authentication and encryption,
making it highly vulnerable to cyberattacks. To ensure in-vehicle security, intrusion detection systems
(IDSs) must detect seen attacks and provide a robust defense against new, unseen attacks while
remaining lightweight for practical deployment. Previous work has relied solely on the CAN ID
feature or has used traditional machine learning (ML) approaches with manual feature extraction.
These approaches overlook other exploitable features, making it challenging to adapt to new unseen
attack variants and compromising security. This paper introduces a cutting-edge, novel, lightweight,
in-vehicle, IDS-leveraging, deep learning (DL) algorithm to address these limitations. The proposed
IDS employs a multi-stage approach: an artificial neural network (ANN) in the first stage to detect
seen attacks, and a Long Short-Term Memory (LSTM) autoencoder in the second stage to detect new,
unseen attacks. To understand and analyze diverse driving behaviors, update the model with the latest
attack patterns, and preserve data privacy, we propose a theoretical framework to deploy our IDS in a
hierarchical federated learning (H-FL) environment. Experimental results demonstrate that our IDS
achieves an F1-score exceeding 0.99 for seen attacks and exceeding 0.95 for novel attacks, with a
detection rate of 99.99%. Additionally, the false alarm rate (FAR) is exceptionally low at 0.016%,
minimizing false alarms. Despite using DL algorithms known for their effectiveness in identifying
sophisticated and zero-day attacks, the IDS remains lightweight, ensuring its feasibility for real-world
deployment. This makes our model robust against seen and unseen attacks.

Keywords CAN bus · Cyberattack · Intrusion Detection System · Anomaly Detection · In-vehicle Network

1

Introduction

In connected and autonomous vehicles (CAVs), many mechanical components have been replaced by electronic
components Foster and Koscher [2015]. These vehicles contain numerous Electronic Control Units (ECUs) connected

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

via various standard automobile in-vehicle communication protocols, such as Controller Area Network (CAN), FlexRay,
Local Interconnect Network (LIN), and Media Oriented System Transport (MOST). Among these protocols, CAN is
considered the de facto protocol for in-vehicle communication Al-Jarrah et al. [2019] due to its features including high
speed, noise cancellation, and ease of use. Although it was initially developed for industrial machines, it has since been
adopted for in-vehicle network communications. However, it lacks basic security features such as sender authentication
and encryption Paul and Islam [2021]. The main reasons for not implementing these security measures in in-vehicle
networks are the intensive use of the vehicle’s limited computational resources and the resultant increased latency,
which could potentially lead to a failure to meet critical safety-related deadlines Pesé et al. [2021], Barati et al. [2014].
Thus, any security measure designed should be lightweight to ensure ease of deployment.

Furthermore, interconnectivity in modern vehicles introduces attack surfaces that expose the vehicle to cyberattacks.
The attack surfaces can be accessed physically or remotely Checkoway et al. [2011]. Physical access can be made
via USB, CD player, onboard diagnostic (OBD)-II port, and so on. In addition, remote access can be made via
short-range wireless technologies such as Bluetooth and radio frequency identification (RFID) and long-range wireless
technologies such as Wi-Fi and long-term evolution (LTE). Therefore, the system is vulnerable to various cyberattacks,
potentially resulting in severe consequences, including the loss of human life Young et al. [2019]. There may be adverse
consequences if an intruder manages to infiltrate the CAN bus system and introduce malicious messages. For instance,
an unauthorized individual with access to the in-vehicle network can tamper with vital functionalities like braking,
door locking mechanisms, and steering, thereby presenting a notable safety hazard. An example of a cybersecurity
breach in the automotive industry can be found in Golson [2016], where two hackers were able to exploit vulnerabilities
in a Jeep’s system and remotely control it to perform dangerous maneuvers, including abruptly turning the steering
wheel and suddenly applying the parking brake at high speeds, leading to catastrophic accidents. In the same way,
hackers were able to exploit a vulnerability in the infotainment system of a General Motors car, allowing them to
gain unauthorized access and steal data remotely Crume [2015]. In 2018, the Keen Security Lab revealed several
vulnerabilities in BMW cars that allow cyber-attackers to inject unified diagnostic services (UDS) packets into the CAN
network, evading the central gateway Lab [2018]. Moreover, in 2020, a Toyota Lexus was the target of an attack by
exploiting a Bluetooth vulnerability, causing unexpected physical motions in the vehicle Lab [2020].

Such attacks not only raise concerns about information security and privacy but also directly impact the safety of drivers,
passengers, and the surrounding area. Therefore, the security of the CAN bus has become a topic of significant research
interest. According to McKinsey’s analysis in Bertoncello et al. [2021], almost all newly sold vehicles worldwide,
approximately 95%, will feature connectivity by 2030, underscoring the critical need for robust CAN bus security
measures. It has been proven that IDSs are an effective method for identifying cyberattacks on in-vehicle networks. An
IDS monitors and identifies malicious activity on the network. In the context of in-vehicle networks, the IDS is often
installed in an ECU and receives and analyzes incoming network traffic. If any abnormal messages are identified, it
will notify other ECUs. In computer network systems, IDSs are used to detect and prevent intrusions. However, many
conventional network security measures cannot be applied directly to in-vehicle networks. Therefore, there is a critical
need for a robust IDS for in-vehicle networks.

Many studies have developed various in-vehicle IDSs using machine learning (ML) approaches. However, existing
approaches overlook three crucial aspects of in-vehicle IDS requirements: robustness, limited computing resources, and
deployment environment. Robustness in an IDS is the ability to detect seen attacks while staying ahead of attackers
by identifying new, unseen attacks that the model has not been trained on. Ensuring the robustness of the IDS will
significantly enhance the safety and security of in-vehicle networks. To design lightweight IDSs deployable in resource-
constrained environments, many existing solutions rely solely on CAN ID features or use traditional ML approaches
with manual feature extraction, neglecting other exploitable features and thus compromising security. Moreover, various
researchers have deployed their IDSs using a traditional centralized learning approach, which involves transmitting
large volumes of data to the cloud for training. This approach raises significant issues, including privacy concerns, high
communication overhead, and longer response times. This paper aims to address these gaps by proposing a robust and
lightweight in-vehicle IDS capable of defending against both seen and new, unseen attacks, and which can be deployed
in a federated learning (FL) environment. To do so, we have laid down concrete objectives:

• Identify the limitations of existing in-vehicle IDSs and design a novel IDS to address these gaps.

• Understand CAN bus data to develop a hybrid IDS.

• Conduct data preprocessing for DL applications.

• Evaluate the hybrid IDS for both seen and unseen attacks, considering the model size.

• Compare the model’s performance against previous studies.

• Propose a hierarchical federated learning (H-FL) IDS to increase the robustness of the IDS.

2

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

1.1 Contributions

This paper proposes a novel multi-stage IDS for in-vehicle network security capable of detecting both seen and unseen
attacks. Furthermore, to take advantage of diverse driving scenarios and behaviors across different locations while
ensuring user privacy protection, we propose a novel theoretical framework for deploying the proposed IDS in an H-FL
environment. The main contributions can be summarized as follows:

• To provide a literature review on the current research on ML approaches capable of detecting seen and unseen

attacks, and to identify the limitations of existing in-vehicle IDSs.

• It examines CAN bus data to extract valuable insights, aiding researchers in enhancing their understanding and

improving security solutions in this field.

• It proposes a robust multi-stage IDS to detect seen and unseen malicious traffic using DL algorithms, achieving

an F1-score exceeding 0.95 and a detection rate (DR) of 99.99% for previously unseen attacks.

• We have developed a novel method for detecting unseen attacks by utilizing an LSTM-autoencoder. This
approach captures the sequential dependencies within a single CAN message, encompassing both the CAN ID
and its payload.

• Focusing on the size, the proposed novel hybrid model is lightweight at 2.98 MB, demonstrating its feasibility

for real-world deployment.

• This paper proposes a novel framework for deploying the proposed IDS in an H-FL environment.

This paper advances the field of in-vehicle IDSs by addressing key limitations of existing solutions. It leverages the
power of DL algorithms and integrates two stages of detection to enhance robustness, deploying the IDS in an H-FL
environment. These improvements set a new standard for further advancements toward achieving an optimally secure
in-vehicle network, making it more difficult for attacks to succeed. Moreover, our analysis of CAN bus data provides
valuable insights for researchers, aiding in the development of more effective security measures for in-vehicle networks.
Our work paves the way for future research to explore advanced DL models, ultimately enhancing the security and
reliability of CAVs. By pushing existing boundaries, we seek to contribute to a securer and more resilient automotive
cybersecurity landscape. To the best of our knowledge, this is the first study to utilize a hybrid approach in in-vehicle
IDSs to detect seen and unseen attacks using DL algorithms rather than traditional ML algorithms and to propose
deploying the in-vehicle IDS in an H-FL.

The remainder of this paper is organized as follows. Section 2 presents the background of the CAN bus protocol and
attack methods. Section 3 discusses the related work. Section 4 presents the methodology of the proposed IDS. Section
5 presents and evaluates the experimental results. Section 6 provides discussions. Finally, Section 7 concludes the paper
and presents potential directions for future work.

2 Background and Attack Methods

In this section, we provide background information on CAN bus protocol security and attack methods.

2.1 Controller Area Network Protocol

The CAN bus is the primary communication protocol between multiple ECUs in in-vehicle networks. Robert Bosch
developed the CAN bus protocol in 1985 to reduce the weight of wires, complexity, and cost Specification [1991].
Due to its high speed and efficiency, the CAN bus is widely used as the default communication standard for in-vehicle
communication systems Hoang and Kim [2022]. The CAN bus is a message-based broadcast protocol where ECUs
transmit data in a predefined data frame as messages to all ECUs. Despite its importance, the CAN bus protocol lacks
security features in its design, making it vulnerable to attacks on confidentiality, integrity, and availability Paul and
Islam [2021], Rajapaksha et al. [2023], Aliwa et al. [2021].

2.2 Attack Methods

As mentioned in the 2.1 subsection, the CAN bus is vulnerable to various cyberattacks due to its broadcast nature
and lack of built-in encryption or authentication Paul and Islam [2021]. To launch an attack, the attacker must first
gain access to the CAN bus system, which is possible through different methods like the OBD-II port or wireless
technologies Aliwa et al. [2021], Checkoway et al. [2011]. Having successfully gained access, the attacker can inject
harmful messages and launch various attacks such as DoS, spoofing, and frame fuzzification attacks. These attacks are
depicted in Figure 1.

3

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

(a) DoS Attack

(b) Spoofing Attack

(c) Frame Fuzzification Attack

Figure 1: CAN Bus Attacks

Denial-of-Service Attack (DoS): The goal of a DoS attack is to consume the CAN bus bandwidth by transmitting a
large volume of messages, which may result in unexpected system behavior. As the identifier sets the message priority,
the attacker sends many messages with identifier = 0 to the CAN bus (see Figure 1a). This message will have the
highest priority Hoang and Kim [2022].

Spoofing Attack: In this type of attack, an unauthorized attacker targets specific CAN IDs and tries to inject fabricated
messages to control particular functions (see Figure 1b). Because the CAN IDs are spoofed and look legitimate, it
becomes challenging to distinguish between legitimate and fabricated messages, leading to system malfunction Hoang
and Kim [2022].

Frame Fuzzification Attack: An attacker injects random messages, which appear to be legitimate traffic, into the CAN
bus network system (see Figure 1c). Frame fuzzification attacks can compromise the ECUs and cause unexpected
behavior in the vehicle, leading to problems like steering wheel shaking, unpredictable signal light on/off switching,
and automatic gear shifts Lee et al. [2017].

3 Related Work

This section reviews state-of-the-art research focused on the development of in-vehicle IDSs capable of detecting both
seen and unseen attacks, and their limitations. It also reviews existing federated-based in-vehicle IDSs, examines
the broader impact of in-vehicle network security on urban transportation systems, and highlights the novelty of our
research within this context.

3.1

In-Vehicle IDSs and Limitations

Research on developing in-vehicle IDSs has significantly increased over the past few years due to the critical need
to enhance the security of in-vehicle networks and identify cyberattacks. Researchers have explored a wide range of
approaches to developing these systems. In this paper, we focus on studies that develop in-vehicle IDSs using DL
and ML approaches. An IDS can be either a signature-based or an anomaly-based system Hoppe et al. [2009]. Some
studies have focused on signature-based methods to detect and classify seen attacks Paul and Islam [2021], Hossain
et al. [2020a,b], while others have employed anomaly detection methods to identify unseen or zero-day attacks Song
and Kim [2021], Wei et al. [2022]. To further improve the robustness and detection capability of the in-vehicle IDS, a
few papers have developed an in-vehicle IDS that can identify both seen and unseen attacks Zhang et al. [2019], Hoang
and Kim [2022], Seo et al. [2018], Yang et al. [2022a], demonstrating significant advancements in this critical area of
cybersecurity. These studies and their limitations are discussed below and summarized in Table 1.

Table 1: Related Works of ML-based IDSs for in-vehicle Network

Ref

Year Category

Algorithm

Zhang et al. [2019]

2019

Hoang and Kim [2022]

2022

Supervised
Semi-
supervised

Seo et al. [2018]

2018 Unsupervised

Yang et al. [2022a]

2022 Hybrid

Our
work

2023 Hybrid

DNN
AE,
GAN
GAN
DT, RF, ET,
XGBoost,
CL-k-means
ANN,
LSTM-AE

Dataset

Simulation

Seen
Attacks
✓

Unseen
Attacks
✓

M-C

ID-based
Detection
✓

Payload-based
Detection
✓

Car-Hacking Seo et al. [2018]

Car-Hacking Seo et al. [2018]

Car-Hacking Seo et al. [2018],
CICIDS2017 Sharafaldin et al. [2018]

Car-Hacking Seo et al. [2018]

✓

✓

✓

✓

✓

✓

✓

✓

✓

✓

✓

✓

✓

✓

✓

✓

DL FL

✓

✓

✓

✓

✓

DL: Deap Learning, FL: Federated Learning, M-C: Multi-classification.

4

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

Zhang et al. Zhang et al. [2019] have proposed a DNN-based IDS that aims to automatically extract features for the IDS
from the vehicle’s data packets. The authors applied gradient descent with momentum (GDM) and gradient descent with
momentum and adaptive gain (GDM/AG) techniques. The study’s results demonstrate the model’s capability to detect
replay attacks effectively. The authors accessed the sensor readings, using them as separate features. However, this
method demands either having access to the CAN database (DBC) file or having knowledge about the CAN payload.

Hoang et al. Hoang and Kim [2022] and Seo et al. Seo et al. [2018] have showcased their IDSs’ ability to detect both
seen and unseen attacks. However, their IDSs mainly rely on the CAN ID as a singular feature; selecting only the CAN
ID feature will limit the detection ability to detect attacks that involve payload manipulation Rajapaksha et al. [2023].

Hoang et al. Hoang and Kim [2022] propose a lightweight, semi-supervised, learning-based IDS to detect in-vehicle
network attacks. The proposed IDS in their study integrates two DL models: autoencoders and generative adversarial
networks (GAN). Their IDS was trained on unlabeled data to learn the patterns of normal and malicious data. Only a
few labeled samples were used during the subsequent supervised training phase.

Seo et al. Seo et al. [2018] have developed a GAN-based IDS (GIDS) for in-vehicle network security. The proposed IDS
was trained by solely utilizing the patterns of CAN IDs from CAN data and then converting the extracted CAN IDs into
a simple image. GIDS has two discriminative models to detect both seen and unseen attack data. The first discriminator
is specifically trained to handle attacks. In contrast, the second discriminator and the generator are co-trained through
an adversarial process. While the generator generates modified images, the second discriminator receives both modified
and real CAN images, and its role is to differentiate between the modified and real images. Nevertheless, using the
CAN ID as the only feature limits the detection capability of payload manipulation attacks.

The aforementioned studies employ either supervised learning-based methods or unsupervised learning-based methods.
Supervised learning-based methods are frequently used to develop models distinguishing between normal and attack
traffic. This technique focuses on optimizing the decision boundary to minimize classification errors on the training
set and demonstrate good generalization capabilities on the testing set. Despite the high accuracy and low false
alarm rate (FAR) of these models, they rely heavily on well-labeled and balanced datasets to reach their full potential,
which is often difficult to achieve in practical situations. Additionally, because attackers continuously attempt to
evade detection and use new, previously unseen attacks, supervised learning-based models may struggle to recognize
unfamiliar attack patterns not present in the training data Vikram et al. [2020]. This limitation can lead to significant
security consequences. Unsupervised learning-based methods, meanwhile, build models exclusively using normal data,
relying on profiling normal traffic behaviors to detect anomalous traffic that could indicate a potential attack. As a
result, unsupervised learning-based models are well suited to detecting previously unseen attacks Pratomo et al. [2018].

To leverage the strengths of both approaches, Yang et al. Yang et al. [2022a] have developed a multi-tiered hybrid
IDS, MTH -IDS, to protect intra-vehicle and external networks from cyberattacks. MTH-IDS combines supervised and
unsupervised models. Despite achieving good results, the proposed IDS has certain limitations that we aim to address.

One significant limitation to note is that the authors used only four features—CAN ID, D5, D3, and D1—to train the
model after feature extraction. While this strategy may result in a more efficient model, it does create the potential
for an attacker to manipulate other features that were not considered during the model’s training process Kocher and
Kumar [2021]. This is a crucial limitation in CAN bus data for three reasons. First, selecting a subset of features from
the CAN bus payload as important features and discarding non-important features could pose a risk, as attackers might
exploit the neglected features, effectively bypassing the model Li and Vorobeychik [2014], Zhang et al. [2015]. Second,
the evolving landscape of attack scenarios means that features chosen to detect one category of attacks may become
outdated or insufficient for addressing new, unseen attacks Kocher and Kumar [2021]. Third, upon closer examination
of the CAN bus data, we noticed that each CAN ID exhibits distinct patterns of data field values. For example, CAN
ID 399 consistently has zero values in data fields D2, D3, D4, D6, and D7, which remain unchanged. By contrast, in
CAN ID 320, the data fields that are always 0 are D1, D2, and D3. Table 2 displays the constant zero values in blue,
indicating data that never changes throughout the dataset. Data highlighted in yellow represents changing values, while
data highlighted in green denotes constant non-zero values. Consequently, features that are significant (possessing
varying values) for one CAN ID may not hold relevance for another, making the selection of a consistent subset of
important features for all CAN IDs impractical due to the inherent nature of CAN bus data. This observation can help
researchers understand the CAN bus data and make their IDS models more focused on the most significant features,
potentially improving their generalization capability.

Another limitation pertains to the deployment approach. Yang et al. suggest conducting the training process on a server
machine and the testing process on the CAN bus. However, this deployment approach requires training the data on a
remote server, which involves sending sensitive data to a server for training, raising privacy concerns.

In the unsupervised model, the F1-score of the proposed MTH-IDS was only 0.82. To improve this result, the authors
add another tier of two biased classifiers. Training these biased classifiers on specific errors—false positives (FPs) and

5

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

Table 2: Constant and Changing Data in CAN Message
CAN ID D0 D1 D2 D3 D4 D5 D6 D7
00
00
00
00
00
00
00

399
399
.
.
.
399
399

254
254
.
.
.
254
254

00
00
00
00
00
00
00

60
61
.
.
.
74
75

59
60
.
.
.
94
95

00
00
00
00
00
00
00

00
00
00
00
00
00
00

00
00
00
00
00
00
00

false negatives (FNs)—may lead to poorer performance when we test the model on new, unseen data. Additionally,
adding this tier transforms the model from being purely unsupervised. Resulting in a dependency on labeled datasets,
which are often difficult to implement in practical situations.

A key distinction between MTH-IDS and our approach is our use of DL algorithms over conventional ML models.
Multiple authors have found that DL-based IDSs outperform traditional ML IDSs in automotive applications Mehedi
et al. [2021]. This superiority is due to several factors: DL methods are more adaptive, continually being refined
with incoming data, which is particularly suitable for the nature of CAN bus data Zhang et al. [2019]. Additionally,
traditional ML often requires manual feature engineering, such as applying correlation-based feature selection, which
can be time-consuming Nagarajan et al. [2023]. In contrast, DL automatically deduces features, allowing algorithms
to directly discern optimal features from raw data Lampe and Meng [2023]. Furthermore, DL IDSs are especially
capable of detecting novel attacks and can scale more effectively to highly complex in-vehicle network data while
maintaining efficacy Lampe and Meng [2023]. Therefore, there is a need to develop a robust, lightweight in-vehicle
IDS that addresses previous limitations.

3.2 Federated-based In-Vehicle IDSs

FL is a privacy-preserving decentralized learning technique that trains models locally without transferring row data to a
centralized server. Instead, it transfers model parameters to a centralized server, which aggregates the clients’ models to
build a shared global model Agrawal et al. [2022]. The integration of FL into IDSs addresses the growing need for
enhanced security and privacy in our interconnected society. Although some previous works Alsamiri and Alsubhi
[2023], Driss et al. [2022], Shibly et al. [2022], Yu et al. [2022], Zhang et al. [2023], Yang et al. [2022b] have deployed
their in-vehicle IDSs in an FL environment, all the proposed FL works used a standard (non-hierarchical) architecture,
relying solely on one central server (aggregator). However, this can introduce performance challenges, particularly
due to delays in sharing the model between the central aggregator and numerous devices. Furthermore, this central
server poses a risk as a single point of failure Rana et al. [2022] and is restricted to limited driving behaviors under its
coverage Liu et al. [2020].

3.3

Impact on Urban Transportation Systems

The impact of securing in-vehicle networks in CAVs extends to the broader field of urban transportation planning, where
vehicles are integral to the overall system. Urban transportation research aims to mitigate traffic congestion Almatar
[2023a], improve safety, increase the adoption of renewable energy Almatar [2023b], and advance sustainable mobility
Almatar [2023c]. A recent survey Rahman and Thill [2023] examining the impacts of CAVs on urban transportation
and the environment found that CAVs would decrease energy consumption and protect the environment by reducing
emissions. Furthermore, these vehicles could significantly reduce traffic crashes involving human error while increasing
the convenience and productivity of passengers. However, there are widespread concerns about personal safety, security,
and privacy due to the potential for cyberattacks. Therefore, enhancing the security of CAVs would significantly
contribute to the improvement of urban transportation systems.

3.4 Research Novelty

While previous studies have achieved notable results in specific areas, they also have several limitations. Compared
to existing studies related to in-vehicle IDS, our proposed IDS offers the following advantages: 1) It uses DL rather
than traditional ML, which has proven to be more efficient in automotive applications and is capable of detecting novel
attacks more effectively Mehedi et al. [2021], Lampe and Meng [2023]. 2) It employs a hybrid model (signature-based
and anomaly detection) instead of relying on a single model, which has been shown to improve detection results Musa
et al. [2020]. 3) It successfully detects both seen and new, unseen attacks. 4) Despite using DL algorithms, it is a

6

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

lightweight IDS. 5) It utilizes both CAN ID and payload as features, which enables detection of CAN ID changes
and payload manipulation attacks Rajapaksha et al. [2023]. 6) It continuously learns by labeling and updating the
signature-based classifier when a new, unseen attack is detected. 7) It leverages diverse driving behaviors by being
deployed in an H-FL environment.

The novelty of this paper lies in three key aspects: the design of the IDS, the algorithms used, and the deployment
approach. First, our proposed in-vehicle IDS employs a cascaded multi-stage approach to detect both seen and unseen
attacks. Unlike other multi-stage IDS designs in the literature, our IDS uses the first stage to classify traffic into seen
attacks and normal data. The second stage then re-examines the data classified as normal in the first stage to detect
unseen attacks that bypassed the initial model, providing an additional layer of protection. Furthermore, the IDS
continuously learns by labeling and updating the classifier in the first stage when a new, unseen attack is detected.
Secondly, we use a hybrid approach (ANN and LSTM-autoencoder) that leverages DL algorithms. By doing so, our
proposed IDS ensures a multi-layered defense mechanism against potential threats and improves detection performance
compared to single-point IDSs Hbaieb et al. [2022]. Thirdly, to further enhance the robustness of the in-vehicle IDS, our
approach addresses the significant drawbacks of previous methods by proposing its deployment in an H-FL environment.
This approach aims to build a more robust global model that takes advantage of diverse driving scenarios and behaviors
in different locations while ensuring user privacy protection.

In summary, the review of existing literature reveals several research gaps and shortcomings, highlighting the broader
impact of in-vehicle network security on urban transportation systems and emphasizing the need to improve the security
of these networks. These gaps provide a critical foundation for the design and novelty of our proposed IDS.

4 Methodology

In this section, we present the methodologies used to develop our proposed in-vehicle IDS. First, we explain the
proposed in-vehicle IDS, including data preprocessing; the first stage, a supervised model (ANNs); and the second stage,
an unsupervised model (LSTM-autoencoder). Next, we provide details on training and testing the model, including
ANN hyperparameter tuning and LSTM-autoencoder hyperparameter tuning. Finally, we present the proposed H-FL
framework.

4.1 Proposed In-vehicle IDS

In Section 3, we highlighted the limitations of existing in-vehicle IDSs. To address these limitations, we introduce
a multi-stage IDS designed to protect in-vehicle networks from seen and unseen attacks by using a hybrid approach
(supervised and unsupervised algorithms). We adopt a hybrid approach to mitigate the risks inherent in relying on a
single model. Integrating multiple ML models can significantly enhance performance, improve data security, and reduce
the FN rate compared to using a single model Driss et al. [2022], Musa et al. [2020]. These benefits are particularly
valuable for in-vehicle networks, where errors can be costly. Additionally, our proposed hybrid approach increases
protection against attackers, who must now evade two models instead of just one.

Our proposed IDS integrates both supervised and unsupervised models. As illustrated in Figure 2, the CAN bus data
first enters the data preprocessing stage, followed by the supervised classifier in the initial stage. Subsequently, the
normal data is processed by the second model to identify any previously unseen attacks. The supervised model is
primarily responsible for detecting and categorizing previously seen attacks based on historical data. By placing the
supervised classifier model first, the IDS can quickly filter out any attacks based on its training and accelerate the
detection process. The subsequent unsupervised model serves as a secondary layer of protection against unseen attacks
that bypass the first model. When the supervised model makes a mistake and classifies the malicious traffic as normal,
the unsupervised model can detect this and flag it as an anomaly. The unsupervised model, which works as an anomaly
detection model, is trained solely on normal data, and any samples that deviate significantly from the learned patterns
are identified as an anomaly or an unseen attack. Once the unsupervised model detects malicious traffic, it is flagged for
further investigation. Any anomalies detected by the unsupervised model that are later confirmed as threats will have a
new attack label generated. This new label will be used to further train and refine the supervised model, enabling it to
recognize such attacks in the future and ensuring the system improves over time. As the vehicular environment evolves,
new attack vectors may emerge. The unsupervised model ensures that the system remains adaptive and resilient in the
face of changing attacks, even if the supervised model has not been trained on them. This comprehensive multi-stage
IDS ensures coverage for both seen and unseen attacks. For broader applicability, the proposed IDS can learn the
legitimate CAN IDs and normal behavior for each vehicle at design time and monitor the network to detect any attacks
during operational runtime.

7

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

Figure 2: Workflow Model Depiction of Proposed Multi-stage IDS for In-vehicle Network

Our proposed IDS provides a comprehensive and robust solution to secure in-vehicle networks. Furthermore, our IDS
addresses significant challenges associated with previous approaches by deploying it in a FL environment. Utilizing
FL allows the IDS to benefit from various driving scenarios, enhances its resilience against new and unseen attacks,
and enables continuous learning without compromising the privacy and security of the training data. With the rapid
development of in-vehicle technologies and communication protocols, having a resilient IDS ensures that we are
prepared for both current and future threats.

4.1.1 Data Preprocessing

In data preprocessing, data was converted into a format suitable for use by deep neural networks. This was achieved by
applying different operations. Figure 3 shows the data processing applied to each feature in the dataset. The dataset
contained four files, each corresponding to a specific attack (DoS, frame fuzzification, gear, and RPM), with both attack
and normal instances. Table 3 shows the number of attacks and normal instances in each file. We processed each file
individually and then concatenated them into a single dataset. We shifted the flag field to the last column and filled
non-available data bytes with NAN values. Given the extensive data points we had, we removed any row with these
missing values in the data fields. The CAN ID and data fields were in hexadecimal values. We converted the CAN
ID and data values from hexadecimal to decimal values as per the ML requirement. Most ML algorithms require the
conversion of categorical data into numerical data. Therefore, after concatenating the datasets into one dataset, a label
encoder was employed to convert categorical features in the flag feature (Normal, DoS, frame fuzzification, gear, and
RPM) into numerical representations to facilitate their use as inputs in ML algorithms.

As shown in Table 3, the dataset comprised millions of data points and was highly imbalanced, with the number
of attacks accounting for 14.06% and normal data making up 85.94%. This could result in high processing times
and produce biased models. To mitigate issues related to the dataset’s size and model complexity, data sampling is
a common approach used to generate a representative sample from the original data Faraoun and Boukelif [2006].
After reviewing and experimenting with various data sampling methods, we adopted the same sampling approach used
in Yang et al. [2022a]. In their work, they employed the K-means clustering algorithm for data sampling and then
addressed class imbalance issues using the synthetic minority oversampling technique (SMOTE). Figure 4 depicts the
difference between the number of samples in the original data and the number after applying sampling and SMOTE to
balance the data. Although we trained the models on sampled data, we tested them on the remaining dataset to ensure
that the models were well generalized and capable of recognizing the entire dataset. We used this method only for
unsupervised anomaly detection because the supervised classifier handled the entire dataset efficiently and quickly.

8

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

Figure 3: Data Preprocessing

Attack type
DoS
Frame Fuzzification
Gear
RPM
Total

Table 3: Dataset Overview
Attack Instances
587,521
491,847
597,252
654,897
2,331,517 (14.06%)

Normal Instances
3,078,250
3,347,013
3,845,890
3,966,805
14,237,958 (85.94%)

Figure 4: Comparison between the number of data classes before and after sampling and balancing data

We considered nine columns (CAN ID and eight data values) as the features in our experiment. This choice was made
to effectively detect any manipulation of either the CAN ID or the payload. We opted to include the CAN ID feature
because the utilized dataset Seo et al. [2018] was created by injecting attacks into arbitrary CAN IDs, which made
incorporating this feature crucial for capturing the distinct characteristics of cyberattacks. To avoid biased models and
potentially inaccurate results due to the clear correlation between timestamps and cyberattack simulation intervals, the
timestamp feature was intentionally excluded. In addition, we excluded the data length code (DLC) feature since it could
be correlated with the data fields, given that DLC represents the payload’s length. To decrease the feature dimensions,
we decided not to consider DLC. We then applied the StandardScaler algorithm to scale the data. In comparison to
other algorithms, StandardScaler was able to find a better balance between handling outliers and preserving the range of
values. It standardizes data by subtracting the mean value, resulting in a zero mean, and then dividing by the variance,
thus giving the distribution unit variance, as shown in Equation (1):

Where, Xscaled represents the scaled value, X is the original value, and Xmean and Xstd denote the mean and standard
deviation, respectively.

Xscaled = (X − Xmean)/Xstd

(1)

9

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

This step is important because network traffic data can possess differing ranges, and normalized (scaled) datasets tend
to enhance the performance of ML models Ali Alheeti and McDonald-Maier [2018]. Failure to normalize the dataset,
especially when its features have different scales, may cause the ML model to concentrate primarily on the features
with larger scalesYang et al. [2022a]. Table 4 shows the data features and types before and after data preprocessing.

Table 4: Data Features and Types Before and After Data Preprocessing

Feature Before
CAN ID hexadecimal
hexadecimal
D0
hexadecimal
D1
hexadecimal
D2
hexadecimal
D3
hexadecimal
D4
hexadecimal
D5
hexadecimal
D6
hexadecimal
D7
string (T, R)
Flag

After
decimal integer
decimal integer
decimal integer
decimal integer
decimal integer
decimal integer
decimal integer
decimal integer
decimal integer
decimal integer (0,1,2,3,4)

4.1.2 First Stage: Supervised Model

We reviewed various DL algorithms for attack detection and multi-classification and concluded that artificial neural
networks (ANNs) were the optimal choice for our data for the following reasons:

1. ANNs introduce non-linearity into the model, which makes them capable of modeling complex patterns and

relationships that linear classifiers might miss.

2. Unlike traditional methods, ANNs can automatically learn the best features directly from the raw data without
requiring explicit feature engineering. This can lead to better performance, especially in CAN bus data, where
each CAN ID has distinctively informative features.

3. ANNs are adaptive systems, making them suitable in situations where data is continuously evolving.
4. ANNs can produce highly competitive results.

However, while ANNs can be an excellent choice, they can be computationally intensive. To address this, we simplified
the ANN architecture by reducing the number of layers and neurons while still achieving the highest DR.

4.1.3 Artificial Neural Networks

ANNs are ML algorithms inspired by the behavior of biological neurons in the brain and the central nervous system
McCulloch and Pitts [1943], Rosenblatt [1958]. ANNs’ inputs pass through one or more hidden layers, assign weights,
and produce an output. Figure 5 depicts the ANN architecture. ANNs can adjust their internal parameters, known as
weights and biases, for both the hidden and output layers. This adaptive feature means that ANNs can understand the
deep and non-linear interrelations between dependent and independent variables without any prior knowledge Tu [1996].
In contrast to traditional classification algorithms that often demand knowledge of the system’s probability model, ANNs
operate as a “black box” that can adapt to the underlying system model Zhang [2000]. Their adaptability, particularly in
high-dimensional datasets, addresses challenges associated with conventional algorithms such as k-nearest neighbor and
decision trees Dreiseitl and Ohno-Machado [2002]. Across various application domains, ANNs have been employed
for classification tasks and have also demonstrated their efficacy in several computer security areas, including detecting
network attacks Wu et al. [2015], Shenfield et al. [2018].

4.1.4 Second Stage: Unsupervised Model

The second stage of the proposed multi-stage IDS is an unsupervised model that acts as an anomaly detector, identifying
anomalies or unseen attacks that bypass the first stage. Unsupervised learning-based models are particularly well suited
to detecting previously unseen attacks Pratomo et al. [2018]. We selected the LSTM-autoencoder model as the anomaly
detector model for in-vehicle IDS for several reasons. Firstly, as an unsupervised neural network, the autoencoder does

10

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

Figure 5: ANN Architecture

not require labeled data, saving significant time and effort. Secondly, research shows that autoencoders are effective at
detecting anomalies and unseen attacks, making them well suited for in-vehicle IDS Hoang and Kim [2022], Wei et al.
[2022], Kukkala et al. [2020]. Lastly, LSTM layers capture temporal dependencies within sequential data, a feature that
conventional autoencoders lack. These features make the LSTM-autoencoder model a robust and efficient solution for
detecting anomalies and enhancing the security of in-vehicle networks.

4.1.5 LSTM-Autoencoder

The Long Short-Term Memory (LSTM) autoencoder consists of both LSTM and autoencoder components. LSTM,
a type of recurrent neural network (RNN), is designed to handle sequential data and can learn complex dynamics
within the temporal order of input sequences by using internal memory to store information over long sequences. This
capability is particularly useful for CAN bus data, which is sequential Rajapaksha et al. [2023]. In contrast, autoencoders
are neural network architectures designed to learn efficient representations of input data by attempting to reconstruct the
original data as accurately as possible. By combining LSTM with an autoencoder, we aimed to capture the sequence
order in each CAN bus message, which classic autoencoders might overlook. The chosen LSTM-autoencoder consists
of two interconnected LSTMs: the first encodes sequences of features into a fixed-size vector, and the second decodes
this vector back into a sequence. In the context of detecting anomalies in the CAN bus, the LSTM-autoencoder was
trained only on normal data. This allowed it to accurately learn to reconstruct the benign patterns it was trained on.
When test data was presented, input data was first encoded by the LSTM into a fixed-size vector. Another LSTM
then decoded this vector to reconstruct the input data. Any deviations in reconstruction can be potential indicators of
anomalies.

The motivation for using the LSTM-autoencoder in this context arose from the sequential nature of the CAN ID and its
associated data fields. Incorporating both the CAN ID and its data fields(payload) is essential because normal data fields
for one CAN ID might be considered unusual for another CAN ID. The LSTM-autoencoder was trained on normal
sequences, with any deviation from these established sequences subsequently flagged as anomalous. However, it is
worth noting that several studies have used sequence-based models to explore the sequential dependencies between
CAN IDs only or multiple CAN bus messages to detect anomalies. However, to the best of our knowledge, there has
been no research examining the order dependence within a single CAN message, including both the CAN ID and its
payload. This is important because CAN IDs can follow periodic or event-driven patterns, and sequences of CAN IDs
can change when event-triggered messages occur on the CAN bus Rajapaksha et al. [2023]. For example, the sequence
of CAN IDs or CAN messages can change when a sudden event happens, such as someone opening the door. We
trained an LSTM-autoencoder model to reconstruct benign sequences with minimal errors, expecting the model’s inputs
and outputs to look alike. However, when a malicious sequence was fed into the model, the model was expected to fail
at reconstructing the sequence. Therefore, the input and output vectors were expected to differ significantly. Figure 6
depicts the architecture of the LSTM-autoencoder.

11

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

Figure 6: LSTM-Autoencoder Architecture

4.2 Training and Testing the Model

To prevent overfitting in ML models, we applied the data partitioning method outlined in Gao et al. [2019] by dedicating
70% to training and the subsequent 30% to testing the model’s performance. In the ANN model, we trained the model
using labeled data to learn the relationships between the features and the targets. Then, we tested the model on test data
to assess the quality of the model. The ANN works as a multi-class classifier, and the output will be normal or attack
type, including DoS, frame fuzzification, RPM, and gear spoofing. Further details regarding these attacks are discussed
in Section 5.2. The data classified as normal in the first stage of the IDS (ANN) served as input for the second stage
(the LSTM-autoencoder). Our experiment involved adjusting multiple hyper-parameters, such as batch size, number of
units, learning rates, optimizers, activation, and loss functions. Through systematic experimentation, we identified the
most suitable hyper-parameter values that could deliver the best possible performance and efficiency.

4.3 ANN Hyperparameter Tuning

The model was a feedforward ANN that comprised four layers: an input layer, two hidden layers, and an output layer. It
was designed for multi-class classification, targeting five distinct classes (DoS, frame fuzzification, RPM, gear spoofing,
or normal). We employed a grid search approach to systematically explore and identify the optimal hyperparameters for
the ANN classifier. The first layer was the input layer, with an input shape of nine. The next two layers were hidden
layers, which are dense layers, each utilizing 16 neurons and the ReLU activation function. The ReLU function was
preferred in hidden layers because it introduced non-linearity to the model. The output layer comprised five neurons,
corresponding to the number of output labels. For this layer, we employed a softmax activation function, which is
suitable for multi-class classification problems. Considering the one-hot encoded labels, we chose the categorical
cross-entropy loss function for compiling our model. We optimized the model with the Adam optimizer, maintaining
the default values for other parameters. To enhance training efficiency and mitigate overfitting, we integrated an
EarlyStopping callback. Table 5 summarizes the hyper-parameters and their respective values used in tuning the ANN
model.

4.4 LSTM-Autoencoder Hyperparameter Tuning

In the LSTM-autoencoder model provided, hyperparameters were carefully selected for optimal training. However,
before feeding the data into the LSTM-autoencoder, we reshaped the data from a 2D format of (Samples, Features) to a
3D format of (Samples, Time Steps, Features) by using the reshape function. This was because the LSTM requires a 3D
input shape. The model operated on sequences of length time_steps, which was set at 1, meaning each data point was
treated as a sequence of its own. Each of these sequences had nine features, which included the CAN ID and eight other
data fields from the CAN message. This LSTM-autoencoder structure consists of an input layer, two encoder layers, a
RepeatVector layer, two decoder layers, and an output layer. The first LSTM layer, which serves as both the input and
the first encoder layer, has 128 neurons and is designed to return sequences, enabling the stacking of subsequent LSTM
layers. The second LSTM encoder layer, with 64 neurons, does not return sequences. Following the RepeatVector
layer, which replicates its input features, the LSTM decoder consists of two LSTM layers with 64 and 128 neurons,

12

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

Table 5: ANN Parameters for Multi-classification

Parameter
Epoch
Number of Hidden Layers Neurons
Number of Output Layer neurons
Number of Hidden Layers
Input Layer Activation Function
Hidden Layer Activation Function
Output Layer Activation Function
Optimizer
Batch Size
Shuffle
Loss Function

Value
10
16
5
2
ReLU
ReLU
softmax
Adam
256
True
categorical_crossentropy

respectively. The activation function employed in the input and hidden layers was ReLU, chosen for its rapid and
efficient training on large datasets compared to the sigmoid function. To combat overfitting, four dropout layers with a
dropout rate of 20% were instituted after each LSTM layer, randomly deactivating one-fifth of the neurons during every
training iteration. We used a batch size of 64 and 100 epochs. Adam optimizer was used along with mean squared error
(MSE) loss function, which is known for its application in anomaly detection problems. To enhance training efficiency
and to avoid overfitting, we integrated an early-stopping callback and dropout layers.

Table 6: LSTM-Autoencoder Parameters for Binary Classification

Value
Parameter
100
Epoch
ReLu
Input Layer Activation Function
Hidden Layers Activation Function ReLu
Adam
Optimizer
64
Batch Size
0.2
Dropout Rate
True
Shuffle
MSE
Loss Function

Table 6 shows the parameters and their respective values in hyper-tuning the LSTM-autoencoder. We trained the
LSTM-autoencoder using only the normal data labeled in the dataset as 0, but it was tested using both normal and attack
data.

In our anomaly detection method using the LSTM-autoencoder, the model’s capability to reconstruct input data was
crucial for detecting anomalies. The reconstruction errors were calculated using the MSE between the reconstructed
output and the original data. To delineate a boundary for what qualifies as an anomaly, a threshold was established.
Determining the optimal threshold for anomaly detection can be intricate. Through various experiments, we found the
most effective threshold is the sum of the average reconstruction error and one standard deviation of these errors from
the training set. In simpler terms, the threshold creates a margin above the average error, and any data point with an
error exceeding this margin will be considered anomalous. Then, the model can predict anomalies by comparing each
test’s reconstruction error to the pre-defined threshold. The threshold is shown in Equation (2):

Threshold = µ(train_errors) + σ(train_errors)

(2)

In this context, µ represents the mean, while σ indicates the standard deviation.

13

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

4.5 Proposed Hierarchical Federated Learning-based Framework

In this section, we introduce the concept of H-FL, which served as the core technique for enabling our proposed IDS to
leverage diverse driving scenarios and behaviors across different locations while ensuring user privacy protection.

Previous researchers have deployed in-vehicle DSs using a traditional centralized learning approach, which involves
transmitting large volumes of data to the cloud for training. However, this approach raises privacy concerns and involves
high communication overhead and longer response times Alsamiri and Alsubhi [2023]. Therefore, recent research has
shown a growing interest in adopting the FL approach to address these issues.

FL is a unique implementation of a distributed ML approach that involves training a model on edge devices (clients)
without transferring the raw data to a central location McMahan et al. [2017]. Thus, FL is an ideal fit for in-vehicle
IDSs for several compelling reasons. First, the FL approach preserves data privacy since the learned parameters from
local models are sent periodically to the cloud server instead of transmitting the whole row of data. Second, FL allows
multiple participants to develop a robust and efficient global model without compromising user data privacy. This
feature makes it a better option than non-FL approaches Li et al. [2020a], offering real-time model updates and allowing
access to data without contacting the centralized server. Third, FL reduces latency by avoiding transmitting the raw data
to a central server. This is crucial, as sending data to a central server can be costly and may impair the effectiveness of
IDS deployments Campos et al. [2022]. Fourth, FL’s distributed nature and low complexity make it highly suitable for
resource-constrained hardware deployments Driss et al. [2022]. Based on the guidelines provided by the International
Telecommunication Union for IDS in vehicular networks in 2020 X.1375 Working Group [2020], it is essential that an
in-vehicle IDS offers the capability to regularly update its rule sets. Thus, FL makes the IDS adaptive to new, unseen
attacks by updating local models with new models trained on new, unseen attacks identified in other clients. This
adaptiveness allows the local model to stay up-to-date and more robust against new, unseen attacks. Additionally, since
FL involves training models locally on devices and only sharing model updates, it ensures that sensitive data remains
private and secure throughout the process.

However, the FL approach relies solely on one central aggregator, which can introduce performance challenges,
particularly due to delays in sharing the model between the central aggregator and numerous devices. Moreover, this
aggregator poses a risk as a single point of failure. To address these issues, we decided to deploy the proposed IDS in
H-FL, which incorporates a central aggregator with multiple local aggregators instead of having one central aggregator.
This approach aimed to overcome the limitations of relying solely on a central aggregator Rana et al. [2022].

The architecture of H-FL consists of three layers: the central server, edge servers, and end devices. The end device
layer comprises multiple end devices (vehicles), where each end device has a large amount of local sensor data and a
locally installed model. In the edge server layer, multiple local aggregators act as intermediaries for communication
between end devices and the central server. Their primary roles include transferring model parameters and aggregating
local model parameters. The central server layer, located in the cloud, is accountable for the distribution and continuous
updates of the final global model. Figure 7 depicts a high-level overview of the H-FL process.

At the beginning of each round, the central server initializes a global model. Then, the central server sends the global
model to each local aggregator. Each local aggregator receives the global model, selects a subset of end devices using a
selection approach to participate in the training process, and then dispatches the global model to the selected end devices.
As CAN bus data can vary significantly between vehicle makes and models, we propose that the local aggregator selects
a subset of available end devices (vehicles) based on the similarity in CAN bus data, such as make or model, in specific
geographical areas. Grouping vehicles by similarity in CAN bus data ensures that the global model is trained on similar
and relevant data, yielding more accurate and reliable results. Once the global model is deployed on each end device, it
leverages its local data for training in small batches. After local training, end devices send their trained local model
parameters to the corresponding local aggregator. Each aggregator aggregates all the local model parameters/weights
using an aggregation algorithm to obtain the edge aggregation model. After all local aggregators have completed the
edge model aggregation, they send all the aggregated model parameters to the central server to build a new global
model. These aggregated model parameters contribute to refining and improving the global model, which is then sent
back to the end devices for continuous training. The central server adjusts the global model parameters based on the
aggregated model parameters, preparing for the subsequent round of global training.

The training process in H-FL can be divided into three parts: local training, edge aggregation, and global aggregation.
For example, when a local model identifies an anomaly or previously unseen malicious network traffic, it isolates
the data for further examination. If this anomaly is determined to be a new, previously unseen attack, a new label is
created in the classifier for seen attacks (the first stage in the IDS). In response, the server updates the global model
and transmits the updated version to the edge aggregators and then to the selected end device and relevant end devices.
After each communication round, the end device returns the model’s parameters to the corresponding edge aggregator
and then to the central server, allowing our proposed IDS to adapt. To keep the seen attack detection model effective,

14

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

seen attack data needs to be updated regularly. It continuously monitors for unseen attacks and updates the supervised
classification model upon detection, ensuring its adaptability to new, unseen attacks. This process is repeated until the
desired level of performance is obtained.

Figure 7: A High-level Overview of H-FL Process

5 Results and Evaluations

5.1 Experiment Setup

The implementation was performed in Google Colab Pro, a web-based editor from Google Research that allows users
to write and run arbitrary Python code from the browser. The experimental setup consisted of a 64-bit Ubuntu 20.04.5
LTS operating system, 11th Gen Intel(R) Core(TM) i7-11700 @ 2.50GHz, 31.1GiB RAM, NVIDIA Corporation, and
Python 3.9.16 version.

5.2 Dataset Description

To assess the performance of our proposed model, we utilized a benchmark dataset published by Song et al. Seo et al.
[2018]. This dataset is extensively used in automotive security research and comprises four types of attacks: DoS,
frame fuzzification, engine RPM spoofing, and drive gear spoofing. We selected this dataset because it is based on
real-world traffic data rather than simulated data, and it allows us to compare our proposed IDS approach with similar
work that uses the same dataset Yang et al. [2022a]. For every CAN message, the dataset provides valuable information,
including timestamp, CAN ID, DLC, data field, and flag. The timestamp indicates the precise time when the message
was recorded from the startup. The CAN ID plays a crucial role in determining the priority of multiple messages, with
lower values being given precedence over higher ones. Moreover, the DLC specifies the data field’s length in bytes, up
to 8 bytes. The flag indicates whether the message is normal or an attack. In Table 7, we present the dataset’s features,
descriptions, and data types.

Table 7: Data Features, Descriptions, and Types

Describtion

Feature
Timestamp Time
CAN ID

DLC

Data

Flag

CAN message identifier
The size of the data field, measured
in bytes
Payload (64-bit)
T or R,
T: Attack, R: Normal

Type
float
hexadecimal

integer

hexadecimal

string

To select the most suitable algorithms, we examined the CAN bus data from Car Hacking Dataset Seo et al. [2018],
ensuring a comprehensive understanding of both normal and abnormal behaviors. Attacks include:

15

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

Table 8: Normal and Attack data in Car Hacking Dataset

CAN ID D0 D1 D2 D3 D4 D5 D6 D7
0
0
1
0
9
11
7
33

880
0
55
880
790
790
1087
1087

255
0
0
255
0
0
0
180

8
0
0
10
0
0
240
0

120
0
11
0
0
0
0
0

0
0
22
0
13
0
1
130

64
0
1
0
30
8
2
22

96
0
1
0
40
8
1
1

0
0
0
0
0
0
1
0

Class
Normal
DoS
Frame fuzzification
Frame fuzzification
Normal
RPM
Normal
Gear

DoS Attack: Inject many ZERO values into every CAN bus ID and payload at 0.3 millisecond intervals. This dominates
the BUS, causing legitimate messages to be delayed or blocked.

Frame Fuzzification Attack: Messages are randomly injected into the CAN bus. There are two types of frame
fuzzification attacks present in this dataset:

1. Injecting random IDs (not seen before).

2. Injecting IDs that appear legitimate but have a different payload.

During a frame fuzzification attack, an adversary might expect some valid CAN messages to inadvertently cause
a malfunction in the target vehicle.
It is presumed that the adversary has no prior knowledge of the in-vehicle
communication of the target vehicle. Thus, the adversary injects messages with random CAN IDs and payloads.
This implies that both the CAN IDs observed in normal traffic and those not seen before can be included in a frame
fuzzification attack.

RPM Spoofing Attack: This spoofing attack specifically targets RPM CAN ID: 790, aiming to inject fabricated
messages to control various functions. The legitimate data payload is different from the fabricated messages.

Gear Spoofing Attack: This spoofing technique targets the Gear CAN ID: 1087, attempting to inject fabricated
messages to control functions. While the fabricated messages resemble normal ones, they are not identical. For
illustration purposes, Table 8 presents examples of both normal data and various kinds of attack data. Data represented
in black indicates normal data, while data in red signifies attack data.

5.3 Evaluation Metrics and Performance Evaluation

To assess the robustness of the proposed IDS, we considered various performance metrics such as accuracy (Acc),
F1-score (F1), precision (Pre), recall (Rec)—or, as it is called, DR—and FAR. Metrics were determined based on true
positive (TP), true negative (TN), FP, and FN values. We used the following equations to calculate the metrics used:

Acc =

T P + T N
T P + T N + F P + F N

F 1 = 2 ×

P re × Rec
P re + Rec

P re =

T P
T P + F P

Rec =

T P
T P + F N

F AR =

F P
T N + F P

16

(3)

(4)

(5)

(6)

(7)

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

5.4 Performance Results and Analysis of Seen and Unseen Attacks Detection

This subsection summarizes the results of our proposed IDS in detecting seen and unseen attacks and provides an
analysis of these findings.

Starting with the results for seen attack detection in the first model, the ANN was trained and tested on a labeled dataset
that included normal data and four types of attacks: DoS, frame fuzzification, RPM, and gear spoofing. The performance
of the ANN model is detailed in Table 9, which shows that the ANN model consistently achieved impressive accuracy
and F1-scores exceeding 99% in accurately classifying various types of seen attacks. Additionally, the table highlights
the model’s precision, its DR, and FAR for normal data and each attack category, demonstrating the model’s high
reliability and effectiveness in distinguishing between normal and various types of attacks. Figure 8 displays the
multiclass confusion matrix (CM) of the ANN model, which illustrates the model’s capability to classify test data
into multiple attack categories. Moreover, as depicted in Figure 9, the training and validation losses decreased and
converged over time, which indicates that the model was learning effectively and generalizing well without overfitting.

Table 9: Performance Evaluation of ANN on Seen Attacks Detection
DR(%) FAR(%)
Attack
100
99.95
100
100
99.99

DoS
Frame Fuzzification
Gear
RPM
Normal

Acc (%) F1
99.99
99.99
99.99
99.99
99.99

0.0
0.0005
0.0
0.0
0.012

Pre
1.00
0.99
0.100
0.99
0.99

1.00
0.99
1.00
0.99
0.99

Figure 8: ANN Multiclass Confusion Matrix

Figure 9: ANN Training and validation performance

To evaluate the model’s ability to detect new, unseen attacks, we trained the LSTM-autoencoder on a sample of normal
data and then tested it on the remaining dataset. As shown in Table 10, the LSTM-autoencoder performed well, with an
overall accuracy of 98.59%, an F1-score of 0.95, a DR of 99.99%, and a precision of 0.91 across all types of unseen

17

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

attacks. Despite generating approximately 0.016% FAR, these metrics underscore the model’s efficacy in detecting
new, unseen attacks. For each type of unseen attack, the model successfully detected all attacks with a DR between
99.99% and 100%, accuracy exceeding 98%, and low FAR of 0.016%. However, the F1-score varied from 0.81 to 0.85
for specific types of unseen attacks. Figure 10 shows the binary CM of the LSTM-autoencoder model, illustrating its
performance in classifying the test data into normal (0) and anomaly (1) classes. Figure 10a shows the CM on the
test samples after applying SMOT sampling, as described in Section 4.1.1, while Figure 10b displays the CM for the
remaining test set in the dataset. From the results, it is clear that the model successfully detected all unseen attacks,
even when it had not been trained on them before.

Table 10: Detection Results for Unseen Attacks

Unseen Attack
DoS
Frame Fuzzification
Gear
RPM
All

F1
0.83
0.81
0.84
0.85
0.95

Pre Acc (%) DR (%) FAR (%)
0.71
0.68
0.72
0.74
0.91

98.42
98.41
98.42
98.42
98.59

0.016
0.016
0.016
0.016
0.016

100
99.99
100
100
99.99

(a) SMOT Sampeling

(b) All Remaining Testing Data

Figure 10: LSTM-autoencoder Binary Confusion Matrices

Our results indicate that the ANN successfully detected and classified attacks by type. This capability is crucial, as
identifying the specific attack type aids in selecting appropriate countermeasures and conducting post-attack analysis
Zhao et al. [2022]. As shown in Table 10, the model showed different F1-scores for unseen attack detection when testing
each attack individually compared to testing all attacks together. The F1-score varied from approximately 0.81 to 0.95.
This is because the number of TPs significantly increased when combined, while the number of FPs remained similar.
Consequently, this increase in TPs improved both precision and recall, resulting in a higher F1-score. Moreover, from
the high DR and the constant FAR across all results, we can observe that while the model was able to detect all unseen
attacks, it mistakenly classified some normal data as attacks, accounting for 234,994 FPs. One reason for this could
be that the model was trained on a small sample of normal data. Although having 234,994 FPs out of approximately
14,000,000 is a good result, it should be further improved upon in such a critical application. Nevertheless, our findings
reveal promising results in detecting unseen attacks.

5.5 Model Complexity

This section discusses model complexity in terms of model size (in megabytes, MB) and the number of trainable
parameters. When designing in-vehicle IDS solutions, it is essential to consider the deployment requirements Lokman
et al. [2019]. The development and deployment of IDSs are significantly impacted by the constraints of ECU in-vehicle
networks, which include limited memory storage, computing power, and bandwidth Rajapaksha et al. [2023]. In pursuit
of optimal results, we have simplified the model architecture to minimize its size. The proposed IDS achieves this
reduction by employing a straightforward architecture with a minimal number of layers and neurons in both models,
as well as the dropout regularization technique in the LSTM-autoencoder. Through careful experimentation with
hyperparameters, we optimized the model’s efficiency, resulting in a lightweight architecture. The sizes of the ANN

18

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

Table 11: Comparison with Existing Work

Unseen Attack

DoS
Frame Fuzzification
Gear
RPM
Average

Ours
DR (%) FAR (%) F1
0.016
100
0.016
100
0.016
100
0.016
100
0.016
100

0.95
0.94
0.95
0.95
0.95

MTHIDS Yang et al. [2022a]
DR (%)
100
73
100
100
93.7

FAR (%)
0.0
0.057
0.45
0.003
0.128

F1
1.0
0.84
0.99
0.99
0.96

Table 12: Model Size comparison

Model
MTHIDS Yang et al. [2022a]
AE- GAN Hoang and Kim [2022]
Ours

MB
2.61
-
2.98

Trainable parameters
-
2.15 million
253,582

and LSTM-autoencoder models were calculated to be 0.030 MB and 2.95 MB, respectively. Moreover, the number of
parameters significantly influences the model’s training and testing time. In theory, a model with fewer parameters
will train and test more quickly Hoang and Kim [2022]. The ANN model has 517 trainable parameters, while the
LSTM-autoencoder has 253,065, making a combined total of 253,582 trainable parameters.

5.6 Comparison with Existing Studies

This model is compared with recent work in Yang et al. [2022a], since they used the same dataset and a similar approach
and features. Regarding the seen attack detection results, both have a high DR with an F1-score of 0.99. However,
in detecting unseen attacks, even though it is difficult to obtain a fair comparison, we made an effort to make the
best possible comparison. To do so, we used the same numbers of testing instances for attack and normal instances
as were used in Yang et al. [2022a]. Results in Table 11 show that our model outperformed the results in Yang et al.
[2022a], with a higher DR and lower FAR. For the F1-score, our average was 0.95, while their model achieved a slightly
higher score of 0.96. However, the F1-score for unseen attacks in Yang et al. [2022a] was initially around 0.83, and
they improved the result to 0.96 by implementing two biased classifiers after the unsupervised model, achieving a DR
of around 93%. Training these biased classifiers on FPs and FNs, however, transforms the model from being purely
unsupervised. Although Hoang and Kim [2022] and Seo et al. [2018] used the same dataset as ours, we did not compare
our detection results with theirs because they relied solely on the CAN ID feature to build their models.

Most previous papers do not state the model sizes, except Yang et al. [2022a] and Hoang and Kim [2022], so we
compared our model with theirs. As depicted in Table 12 the model size in Yang et al. [2022a] for the two models is
2.61 MB, and the total size of our models is 2.98 MB, showing that our model is nearly in the same range even though
we used DL, which is considered more resource-intensive than traditional ML. These sizes are notably below the typical
memory capacity of vehicle-level machines, which can exceed 1 GB of RAM Yang et al. [2022a]. Moreover, Table 12
shows that our trainable parameters represent approximately an 88.2% reduction compared to the number of trainable
parameters in Hoang and Kim [2022], even though they only used one feature, which is the CAN ID.

Therefore, the experimental results confirm that our proposed DL-based, in-vehicle IDS is highly efficient and can
effectively detect various types of seen and unseen cyberattacks. Additionally, its lightweight design makes it feasible
for real-world deployment.

6 Discussion

Our analysis revealed several key findings that contribute to the understanding and development of in-vehicle IDSs:

• Hybrid IDSs, such as our proposed IDS, can be a robust solution that not only addresses current threats but
also prepares for future ones. Moreover, the order of each approach is important. For example, we adopted the
seen attack detection before anomaly detection approach for two reasons: to quickly detect any seen attacks
and to double-check the normal data in case an attack bypasses the first model.

• When designing an in-vehicle IDS, several critical decisions should be made during the design phase. One
such decision is to include both CAN ID and payload data without feature selection, as attackers might exploit
any neglected features in the futureLi and Vorobeychik [2014], Zhang et al. [2015].

19

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

• Our analysis of CAN bus data shows that each CAN ID has unique data patterns, so important features for one
ID may not be relevant for another. This variability makes it impractical to select a consistent set of important
features for all CAN IDs, indicating the need to customize feature selection to improve model performance
and generalization.

• The most important finding is that our results prove that DL algorithms can improve the performance of an

IDS while meeting the model size requirements in resource-constrained environments.

• Theoretically, and based on the literature review, an H-FL architecture, which adds an edge layer between the
central server and the vehicles, can overcome several challenges in the traditional FL architecture that consists
only of a server and vehicles. Figure 11 depicts the theoretical framework of the proposed H-FL.

Figure 11: Framework of the proposed Hierarchical Federated Learning Method

7 Conclusions and Future Directions

The aim of this paper was to propose a robust and lightweight multi-stage IDS designed for in-vehicle network security
that is capable of detecting both seen and novel attacks. Our IDS addresses the limitations of existing solutions by
utilizing a hybrid approach and advanced DL algorithms. To further enhance our IDS and leverage diverse driving
behaviors while preserving data privacy, we have proposed a theoretical framework for deploying our IDS in an H-FL
environment. We evaluated the performance of our IDS using a real-world dataset containing various cyberattacks,
including DoS, frame fuzzification, RPM, and gear spoofing. Experimental results demonstrate that the ANN model
effectively classifies seen attacks with an outstanding F1-score of 0.99. Simultaneously, the LSTM-autoencoder
model excels at detecting novel attacks, achieving an F1-score of over 0.95 and a DR of 99.99% with minimal false
alarms. Overall, our proposed IDS effectively detects both seen and novel attacks within in-vehicle networks and
continually updates its knowledge by identifying new, previously unseen attacks, ensuring ongoing improvement over
time. Additionally, our IDS is designed to be lightweight, making it suitable for real-world deployment. By detecting
both seen and novel attacks, our IDS not only addresses current threats but also prepares for future ones. For future
work, we plan to deploy our proposed IDS in a realistic H-FL environment and evaluate its performance.

Although our proposed IDS shows promising results in detecting both seen and novel attacks while maintaining
a compact model size, it has certain limitations. Our IDS has been trained and evaluated within limited driving
scenarios, requiring extensive datasets to model normal behavior accurately. This limitation suggests potential areas for
enhancement, which can be addressed through the following future directions:

• Future research could explore streaming learning, allowing the model to dynamically adjust in real time within

the vehicle to adapt to various driving conditions, thus enhancing detection accuracy.

20

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

• FL can effectively combine models derived from different driving scenarios and vehicle states, greatly
improving in-vehicle IDS performance while protecting data privacy and reducing latency Zhang et al. [2023].
Thus, exploring the field of FL and addressing its challenges, such as data heterogeneity Li et al. [2020b] and
secure communication Barati et al. [2016], can be identified as future trends in in-vehicle IDS research.

• Another crucial future direction is protecting in-vehicle IDSs from adversarial attacks, as a recent study
Aloraini et al. [2024] has highlighted their vulnerability. Protecting in-vehicle IDSs from adversarial attacks
and adapting solutions from other domains could provide valuable insights and improvements to current
in-vehicle IDSs.

References

Ian Foster and Karl Koscher. Exploring controller area networks. login. USENIX Association, 40(6), 2015.

Omar Y Al-Jarrah, Carsten Maple, Mehrdad Dianati, David Oxtoby, and Alex rMouzakitis.
intra-vehicle networks: A review.

Intru-
Ieee Access, 7:21266–21289, 2019.

sion detection systems for
doi:https://doi.org/10.1109/ACCESS.2019.2894183.

Avishek Paul and Md Rabiul Islam. An artificial neural network based anomaly detection method in can bus messages
in vehicles. In 2021 International Conference on Automation, Control and Mechatronics for Industry 4.0 (ACMI),
pages 1–5. IEEE, 2021. doi:https://doi.org/10.1109/ACMI53878.2021.9528201.

Mert D Pesé, Jay W Schauer, Junhui Li, and Kang G Shin. S2-can: Sufficiently secure controller area net-
In Proceedings of the 37th Annual Computer Security Applications Conference, pages 425–438, 2021.

work.
doi:https://doi.org/10.1145/3485832.3485883.

Ali Barati, Ali Movaghar, and Masoud Sabaei. Energy efficient and high speed error control scheme for real
International Journal of Distributed Sensor Networks, 10(5):698125, 2014.

time wireless sensor networks.
doi:https://doi.org/10.1155/2014/698125.

Stephen Checkoway, Damon McCoy, Brian Kantor, Danny Anderson, Hovav Shacham, Stefan Savage, Karl Koscher,
Alexei Czeskis, Franziska Roesner, and Tadayoshi Kohno. Comprehensive experimental analyses of automotive
attack surfaces. In 20th USENIX Security Symposium (USENIX Security 11), San Francisco, CA, 2011. USENIX
Association.

Clinton Young, Joseph Zambreno, Habeeb Olufowobi, and Gedare Bloom. Survey of automotive controller area network
intrusion detection systems. IEEE Design & Test, 36(6):48–55, 2019. doi:https://doi.org/MDAT.2019.2899062.

Jordan Golson.

this time taking control of steering and braking systems.
https://www.theverge.com/2016/8/2/12353186/car-hack-jeep-cherokee-vulnerability-miller-valasek, 2016. (accessed
1 April 2023).

Jeep hackers at

it again,

Jeff Crume. Ownstar: Yet another car hack. https://insideinternetsecurity.wordpress.com/2015/08/05/ownstar-yet-

another-car-hack/, 2015. (accessed 20 March 2023).

Tencent Keen Security Lab. New vehicle security research by keenlab: Experimental security assessment of bmw
cars. https://keenlab.tencent.com/en/2018/05/22/New-CarHacking-Research-by-KeenLab-Experimental-Security-
Assessment-of-BMW-Cars/, 2018. (accessed 10 April 2023).

Tencent

Keen

Experimental
https://keenlab.tencent.com/en/2020/03/30/Tencent-Keen-Security-Lab-Experimental-Security-Assessment-
on-Lexus-Cars/, 2020. (accessed 10 April 2023).

assessment

Security

security

lexus

Lab.

on

cars.

Michele Bertoncello, Christopher Martens, Timo Möller, and Tobias Schneiderbauer. Unlocking the full life-cycle value
from connected-car data. https://www.mckinsey.com/industries/automotive-and-assembly/our-insights/unlocking-
the-full-life-cycle-value-from-connected-car-data, 2021. (accessed 6 April 2023).

CAN Specification. Bosch. Robert Bosch GmbH, Postfach, 50:15, 1991.

Thien-Nu Hoang and Daehee Kim. Detecting in-vehicle intrusion via semi-supervised learning-based convolutional
adversarial autoencoders. Vehicular Communications, 38, 2022. doi:https://doi.org/10.1016/j.vehcom.2022.100520.

Sampath Rajapaksha, Harsha Kalutarage, M Omar Al-Kadri, Andrei Petrovski, Garikayi Madzudzo, and Madeline
Cheah. Ai-based intrusion detection systems for in-vehicle networks: A survey. ACM Computing Surveys, 55(11):
1–40, 2023. doi:https://doi.org/10.1145/3570954.

Emad Aliwa, Omer Rana, Charith Perera, and Peter Burnap. Cyberattacks and countermeasures for in-vehicle networks.

ACM computing surveys (CSUR), 54(1):1–37, 2021. doi:https://doi.org/10.1145/3431233.

21

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

Hyunsung Lee, Seong Hoon Jeong, and Huy Kang Kim. Otids: A novel intrusion detection system for in-vehicle
network by using remote frame. In 2017 15th Annual Conference on Privacy, Security and Trust (PST), pages
57–5709. IEEE, 2017. doi:https://doi.org/10.1109/PST.2017.00017.

Tobias Hoppe, Stefan Kiltz, and Jana Dittmann. Applying intrusion detection to automotive it-early insights and

remaining challenges. Journal of Information Assurance and Security (JIAS), 4(6):226–235, 2009.

Md Delwar Hossain, Hiroyuki Inoue, Hideya Ochiai, Doudou Fall, and Youki Kadobayashi. Lstm-based in-
IEEE Access, 8:185489–185502, 2020a.

trusion detection system for in-vehicle can bus communications.
doi:https://doi.org/10.1109/ACCESS.2020.3029307.

Md Delwar Hossain, Hiroyuki Inoue, Hideya Ochiai, Doudou Fall, and Youki Kadobayashi. An effective in-vehicle can
bus intrusion detection system using cnn deep learning approach. In GLOBECOM 2020-2020 IEEE Global Commu-
nications Conference, pages 1–6. IEEE, 2020b. doi:https://doi.org/10.1109/GLOBECOM42002.2020.9322395.

Hyun Min Song and Huy Kang Kim.

ing noised pseudo normal data.
doi:https://doi.org/10.1109/TVT.2021.3051026.

Self-supervised anomaly detection for

in-vehicle network us-
IEEE Transactions on Vehicular Technology, 70(2):1098–1108, 2021.

Pengcheng Wei, Bo Wang, Xiaojun Dai, Li Li, and Fangcheng He. A novel intrusion detection model for the can bus
packet of in-vehicle network based on attention mechanism and autoencoder. Digital Communications and Networks,
2022. doi:https://doi.org/10.1016/j.dcan.2022.04.021.

Jiayan Zhang, Fei Li, Haoxi Zhang, Ruxiang Li, and Yalin Li. Intrusion detection system using deep learning for

in-vehicle security. Ad Hoc Networks, 95:101974, 2019. doi:10.1016/j.adhoc.2019.101974.

Eunbi Seo, Hyun Min Song, and Huy Kang Kim. Gids: Gan based intrusion detection system for in-vehicle
In 2018 16th Annual Conference on Privacy, Security and Trust (PST), pages 1–6. IEEE, 2018.

network.
doi:https://doi.org/10.1109/PST.2018.8514157.

Li Yang, Abdallah Moubayed, and Abdallah Shami. Mth-ids: A multitiered hybrid intrusion detection system for internet
of vehicles. IEEE Internet of Things Journal, 9(1):616–632, 2022a. doi:https://doi.org/10.1109/JIOT.2021.3084796.
Iman Sharafaldin, Arash Habibi Lashkari, and Ali A Ghorbani. Toward generating a new intrusion detection dataset

and intrusion traffic characterization. ICISSp, 1:108–116, 2018.

Aditya Vikram et al. Anomaly detection in network traffic using unsupervised machine learning approach. In 2020
5th International Conference on Communication and Electronics Systems (ICCES), pages 476–479. IEEE, 2020.
doi:https://doi.org/10.1109/ICCES48766.2020.9137987.

Baskoro Adi Pratomo, Pete Burnap, and George Theodorakopoulos. Unsupervised approach for detecting low rate
attacks on network traffic with autoencoder. In 2018 international conference on cyber security and protection of
digital services (Cyber Security), pages 1–8. IEEE, 2018. doi:10.1109/CyberSecPODS.2018.8560678.

Geeta Kocher and Gulshan Kumar. Machine learning and deep learning methods for intrusion detection systems: recent
developments and challenges. Soft Computing, 25(15):9731–9763, 2021. doi:https://doi.org/10.1007/s00500-021-
05893-0.

Bo Li and Yevgeniy Vorobeychik. Feature cross-substitution in adversarial classification. Advances in neural information

processing systems, 27, 2014.

Fei Zhang, Patrick PK Chan, Battista Biggio, Daniel S Yeung, and Fabio Roli.

fea-
IEEE transactions on cybernetics, 46(3):766–777, 2015.

Adversarial

ture selection against evasion attacks.
doi:https://doi.org/10.1109/TCYB.2015.2415032.

Sk Tanzir Mehedi, Adnan Anwar, Ziaur Rahman, and Kawsar Ahmed. Deep transfer learning based intrusion detection

system for electric vehicular networks. Sensors, 21(14):4736, 2021. doi:10.3390/s21144736.

Jay Nagarajan, Pegah Mansourian, Muhammad Anwar Shahid, Arunita Jaekel, Ikjot Saini, Ning Zhang, and Marc
Kneppers. Machine learning based intrusion detection systems for connected autonomous vehicles: A survey.
Peer-to-Peer Networking and Applications, pages 1–33, 2023. doi:https://doi.org/10.1007/s12083-023-01508-7.
Brooke Lampe and Weizhi Meng. A survey of deep learning-based intrusion detection in automotive applications.

Expert Systems with Applications, 221:119771, 2023. doi:https://doi.org/10.1016/j.eswa.2023.119771.

Shaashwat Agrawal, Sagnik Sarkar, Ons Aouedi, Gokul Yenduri, Kandaraj Piamrat, Mamoun Alazab, Sweta Bhat-
tacharya, Praveen Kumar Reddy Maddikunta, and Thippa Reddy Gadekallu. Federated learning for intrusion
detection system: Concepts, challenges and future directions. Computer Communications, 195:346–361, 2022.
doi:https://doi.org/10.1016/j.comcom.2022.09.012.

Jadil Alsamiri and Khalid Alsubhi. Federated learning for intrusion detection systems in internet of vehicles: A general

taxonomy, applications, and future directions. Future Internet, 15(12):403, 2023. doi:10.3390/fi15120403.

22

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

Maha Driss, Iman Almomani, Zil e Huma, and Jawad Ahmad. A federated learning framework for cy-
berattack detection in vehicular sensor networks. Complex & Intelligent Systems, 8(5):4221–4235, 2022.
doi:https://doi.org/10.1007/s40747-022-00705-w.

Kabid Hassan Shibly, Md Delwar Hossain, Hiroyuki Inoue, Yuzo Taenaka, and Youki Kadobayashi. Personalized
federated learning for automotive intrusion detection systems. In 2022 IEEE Future Networks World Forum (FNWF),
pages 544–549. IEEE, 2022. doi:https://doi.org/10.1109/FNWF55208.2022.00101.

Tianqi Yu, Guodong Hua, Huaisheng Wang, Jianfeng Yang, and Jianling Hu. Federated-lstm based network intrusion
detection method for intelligent connected vehicles. IEEE International Conference on Communications (ICC), 2022.
doi:https://doi.org/10.1109/ICC45855.2022.9838655.

Hengrun Zhang, Kai Zeng, and Shuai Lin.

controller area networks.
doi:https://doi.org/10.1109/TIFS.2023.3240291.

Federated graph neural network for fast anomaly detection in
IEEE Transactions on Information Forensics and Security, 18:1566–1579, 2023.

Jianfeng Yang, Jianling Hu, and Tianqi Yu. Federated ai-enabled in-vehicle network intrusion detection for internet of

vehicles. Electronics, 2022b. doi:https://doi.org/electronics11223658.

Omer Rana, Theodoros Spyridopoulos, Nathaniel Hudson, Matt Baughman, Kyle Chard, Ian Foster, and Aftab
In 2022 Cloud Continuum, pages 1–9. IEEE, 2022.

Khan. Hierarchical and decentralised federated learning.
doi:https://doi.org/10.1109/CloudContinuum57429.2022.00008.

Lumin Liu, Jun Zhang, SH Song, and Khaled B Letaief. Client-edge-cloud hierarchical federated learn-
In ICC 2020-2020 IEEE International Conference on Communications (ICC), pages 1–6. IEEE, 2020.

ing.
doi:https://doi.org/10.1109/ICC40277.2020.9148862.

Khalid Mohammed Almatar. Traffic congestion patterns in the urban road network:(dammam metropolitan area). Ain

Shams engineering journal, 14(3):101886, 2023a. doi:10.1016/j.asej.2022.101886.

Khalid Mohammed Almatar.

Increasing electric vehicles infrastructure in urban areas for efficiently employing
renewable energy. Environment, Development and Sustainability, pages 1–22, 2023b. doi:10.1007/s10668-023-
03723-x.

Khalid Mohammed Almatar. Towards sustainable green mobility in the future of saudi arabia cities:

Im-
plication for reducing carbon emissions and increasing renewable energy capacity. Heliyon, 9(3), 2023c.
doi:https://doi.org/10.1016/j.heliyon.2023.e13977.

Md Mokhlesur Rahman and Jean-Claude Thill.

portation and environment: A comprehensive review.
doi:10.1016/j.scs.2023.104649.

Impacts of connected and autonomous vehicles on urban trans-
Sustainable Cities and Society, 96:104649, 2023.

Usman Shuaibu Musa, Megha Chhabra, Aniso Ali, and Mandeep Kaur. Intrusion detection system using machine
learning techniques: A review. In 2020 international conference on smart electronics and communication (ICOSEC),
pages 149–155. IEEE, 2020. doi:https://doi.org/10.1109/ICOSEC49089.2020.9215333.

Amal Hbaieb, Samiha Ayed, and Lamia Chaari. Federated learning based ids approach for the iov.

In Pro-
ceedings of the 17th International Conference on Availability, Reliability and Security, pages 1–6, 2022.
doi:https://doi.org/10.1145/3538969.3544422.

KM Faraoun and Aoued Boukelif. Neural networks learning improvement using the k-means clustering algorithm to

detect network intrusions. INFOCOMP Journal of Computer Science, 5(3):28–36, 2006.

Khattab M Ali Alheeti and Klaus McDonald-Maier.

nication systems for autonomous vehicles.
doi:https://doi.org/10.1080/21642583.2018.1440260.

intrusion detection in external commu-
Systems Science & Control Engineering, 6(1):48–56, 2018.

Intelligent

Warren S McCulloch and Walter Pitts. A logical calculus of the ideas immanent in nervous activity. The bulletin of

mathematical biophysics, 5:115–133, 1943. doi:https://doi.org/10.1007/BF02478259.

Frank Rosenblatt. The perceptron: a probabilistic model for information storage and organization in the brain.

Psychological review, 65(6):386, 1958. doi:https://doi.org/10.1037/h0042519.

Jack V Tu. Advantages and disadvantages of using artificial neural networks versus logistic regression for predicting
medical outcomes. Journal of clinical epidemiology, 49(11):1225–1231, 1996. doi:https://doi.org/10.1016/S0895-
4356(96)00002-9.

Guoqiang Peter Zhang. Neural networks for classification: a survey. IEEE Transactions on Systems, Man, and
Cybernetics, Part C (Applications and Reviews), 30(4):451–462, 2000. doi:https://doi.org/10.1109/5326.897072.

23

A Robust Multi-Stage Intrusion Detection System for In-Vehicle Network Security using Hierarchical Federated
Learning

A PREPRINT

Stephan Dreiseitl and Lucila Ohno-Machado. Logistic regression and artificial neural network classification models: a
methodology review. Journal of biomedical informatics, 35(5-6):352–359, 2002. doi:https://doi.org/10.1016/S1532-
0464(03)00034-0.

Jianfa Wu, Dahao Peng, Zhuping Li, Li Zhao, and Huanzhang Ling. Network intrusion detection based on a general
regression neural network optimized by an improved artificial immune algorithm. PloS one, 10(3):e0120976, 2015.
doi:https://doi.org/10.1371/journal.pone.0120976.

Alex Shenfield, David Day, and Aladdin Ayesh. Intelligent intrusion detection systems using artificial neural networks.

Ict Express, 4(2):95–99, 2018. doi:https://doi.org/10.1016/j.icte.2018.04.003.

Vipin Kumar Kukkala, Sooryaa Vignesh Thiruloga, and Sudeep Pasricha. Indra: Intrusion detection using recurrent
autoencoders in automotive embedded systems. IEEE Transactions on Computer-Aided Design of Integrated Circuits
and Systems, 39(11):3698–3710, 2020. doi:https://doi.org/10.1109/TCAD.2020.3012749.

Lulu Gao, Fei Li, Xiang Xu, and Yong Liu. Intrusion detection system using soeks and deep learning for in-vehicle

security. Cluster Computing, 22(6):14721–14729, 2019. doi:https://doi.org/10.1007/s10586-018-2385-7.

Brendan McMahan, Eider Moore, Daniel Ramage, Seth Hampson, and Blaise Aguera y Arcas. Communication-efficient
learning of deep networks from decentralized data. In Artificial intelligence and statistics, pages 1273–1282. PMLR,
2017.

Li Li, Yuxi Fan, Mike Tse, and Kuo-Yi Lin. A review of applications in federated learning. Computers & Industrial

Engineering, 149:106854, 2020a. doi:https://doi.org/10.1016/j.cie.2020.106854.
Enrique Mármol Campos, Pablo Fernández Saura, Aurora González-Vidal,

José L Hernández-Ramos,
Jorge Bernal Bernabé, Gianmarco Baldini, and Antonio Skarmeta. Evaluating federated learning for in-
trusion detection in internet of things: Review and challenges. Computer Networks, 203:108661, 2022.
doi:https://doi.org/10.1016/j.comnet.2021.108661.

X.1375 Working Group. Guidelines for an intrusion detection system for in-vehicle networks. Technical Report X.1375,

International Telecommunication Union, 2020.

Qingling Zhao, Mingqiang Chen, Zonghua Gu, Siyu Luan, Haibo Zeng, and Samarjit Chakrabory. Can bus intrusion
detection based on auxiliary classifier gan and out-of-distribution detection. ACM Transactions on Embedded
Computing Systems (TECS), 21(4):1–30, 2022. doi:https://doi.org/10.1145/3540198.

Siti-Farhana Lokman, Abu Talib Othman, and Muhammad-Husaini Abu-Bakar.

Intrusion detection system for
automotive controller area network (can) bus system: a review. EURASIP Journal on Wireless Communications and
Networking, 2019:1–17, 2019. doi:https://doi.org/10.1186/s13638-019-1484-3.

Tian Li, Anit Kumar Sahu, Manzil Zaheer, Maziar Sanjabi, Ameet Talwalkar, and Virginia Smith. Federated optimization

in heterogeneous networks. Proceedings of Machine learning and systems, 2:429–450, 2020b.

Ali Barati, Ali Movaghar, and Masoud Sabaei. Rdtp: Reliable data transport protocol in wireless sensor networks.

Telecommunication Systems, 62:611–623, 2016. doi:https://doi.org/10.1007/s11235-015-0098-2.

Fatimah Aloraini, Amir Javed, and Omer Rana. Adversarial attacks on intrusion detection systems in in-vehicle networks

of connected and autonomous vehicles. Sensors, 24(12):3848, 2024. doi:https://doi.org/10.3390/s24123848.

24

